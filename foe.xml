<?xml version="1.0" encoding="UTF-8"?>
<project name="freenet-foe" default="foe-bundle" basedir=".">
	<description>
This file is to build Freenet as OSGi bundle for the 'Freenet OSGi Experiment' (foe).
	</description>

	<property file="foe.properties"/>

	<property name="test.skip" value="true"/>
	<property name="doc.skip" value="true"/>
	<property name="lib.contrib.dir" value="../foe/orbit/lib/"/>
	<property name="lib.dir" value="../"/>
	<property name="lib.jars" value="foe/FreenetCompress/dist/FreenetCompress.jar concierge/framework/dist/fconcierge.jar foe/FreenetLogger/dist/FreenetLogger.jar"/>

	<import file="build-clean.xml"/>

	<target name="foe-bundle" depends="build">
		<property name="lib.contrib.loc" location="${lib.contrib.dir}" />
		<property name="lib.loc" location="${lib.dir}" />
		<pathconvert property="lib.jars.package" refid="lib.path" pathsep=" ">
			<map from="${lib.contrib.loc}/" to="${lib.contrib.dir.rel}/"/>
			<map from="${lib.loc}/" to=""/>
		</pathconvert>
		<jar jarfile="${main.dst}/FreenetService.jar" basedir="${main.make}">
			<manifest>
				<attribute name="Main-Class" value="freenet.node.Node"/>
				<attribute name="Built-By" value="${user.name}"/>
				<attribute name="Required-Ext-Version" value="${contrib.version.min}"/>
				<attribute name="Recommended-Ext-Version" value="${contrib.version.rec}"/>
				<attribute name="Bundle-ManifestVersion" value="1" />
				<!-- attribute name="Bundle-SymbolicName" value="org.foo.example.Example" / -->
				<attribute name="Bundle-Version" value="1" />
				<attribute name="Bundle-Activator" value="freenet.osgi.freenetservice.FreenetServiceActivator" />
				<attribute name="Import-Package" value="org.osgi.framework;version=1.3.0, freenet.log,
						freenet.osgi.compress,
						net.contrapunctus.lzma,
						org.apache.commons.compress.archivers,
						org.apache.commons.compress.archivers.tar,
						org.apache.commons.compress.compressors.bzip2,
						SevenZip.Compression,
						SevenZip.Compression.LZMA"/>
				<attribute name="Export-Package" value="freenet.keys, freenet.node, freenet.client, freenet.client.async, freenet.client.events, freenet.support, freenet.support.api, freenet.support.io" />
				<section name="common">
					<attribute name="Specification-Title" value="Freenet"/>
					<attribute name="Specification-Version" value="0.7.5"/>
					<attribute name="Specification-Vendor" value="freenetproject.org"/>
					<attribute name="Implementation-Title" value="Freenet"/>
					<attribute name="Implementation-Version" value="0.7.5 ${TODAY} ${git.revision}"/>
					<attribute name="Implementation-Vendor" value="freenetproject.org"/>
				</section>
			</manifest>
			<exclude name="${version.src}"/>
			<zipfileset src="../foe/orbit/lib/freenet-ext.jar">
				<!-- exclude name="org/tanukisoftware/**"/ -->
			</zipfileset>
		</jar>
	</target>

</project>
